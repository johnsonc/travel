/* @preserve Version 0.1, Copyright (c) 2015 David A Krauth */
Almanac=function(){var e=[31,28,31,30,31,30,31,31,30,31,30,31],t=27,n={days_of_week:["Su","Mo","Tu","We","Th","Fr","Sa"],month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],day_post_create:null,year_range:"-50",month_tag:"div",month_class:"month",week_tag:"div",week_class:"week",day_tag:"div",day_class:"day",day_num_tag:"span",day_num_class:"day-num",weekday_wrapper_tag:"div",weekday_wrapper_class:"weekdays",weekday_tag:"span",selector_tag:"div",selector_class:"selector",selector_month_class:"month-select",selector_year_class:"year-select"},a={create:function(e){for(var t,n,a,s=document.createElement(e),o=1;o<arguments.length;o++)if(a=arguments[o],r.is_array(a))for(t=0;t<a.length;t++)s.appendChild(a[t]);else if(r.is_object(a))for(n in a)s.hasOwnProperty(n)?s[n]=a[n]:s.setAttribute(n,a[n]);else a&&(s.textContent=a.toString());return s},option:function(e,t){return this.create("option",e,{value:t})},display_element:function(e,t){"string"==typeof e&&(e=document.getElementById(e)),e.style.display=t?"block":"none"}},r={is_leap:function(e){return e%4==0&&(e%100!=0||e%400==0)},last_day:function(t,n){return e[n]+(1==n&&this.is_leap(t)?1:0)},merge:function(){for(var e,t={},n=0;n<arguments.length;n++){e=arguments[n];for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])}return t},is_object:function(e){return"[object Object]"===Object.prototype.toString.call(e)},iso_string:function(e){var t=e.getDate(),n=e.getMonth()+1;return e.getFullYear()+"-"+(10>n?"0"+n:n)+"-"+(10>t?"0"+t:t)},is_date:function(e){return"[object Date]"===Object.prototype.toString.call(e)},is_string:function(e){return"string"==typeof e},is_array:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},s=function(e,t){var n,a,r=[];for(t=t||(new Date).getFullYear(),e=parseInt(e),a=0>e?-1:1,n=t+e;t!=n;t+=a)r.push(t);return r},o=function(e){var t=a.create(e.weekday_wrapper_tag,{"class":e.weekday_wrapper_class});return e.days_of_week.forEach(function(n){t.appendChild(a.create(e.weekday_tag,n))}),t},c=function(e){return function(){var t=this.parentElement.querySelector('select[data-type="month"]'),n=this.parentElement.querySelector('select[data-type="year"]'),a=this.parentElement.parentElement,s=a.querySelector("."+e.month_class),o=parseInt(t.value),c=parseInt(n.value),i=new Date(c,o);a.replaceChild(p(i,e),s),a.setAttribute("data-date",r.iso_string(i))}},i=function(e,t){var n=a.create("select",{"class":t.selector_month_class});return n.dataset.type="month",n.addEventListener("change",c(t),!1),t.month_names.forEach(function(t,r){n.appendChild(a.option(t,r)),r==e&&(n.selectedIndex=r)}),n},l=function(e,t){var n=0,o=a.create("select",{"class":t.selector_year_class}),i=t.year_range;for(o.dataset.type="year",o.addEventListener("change",c(t),!1),r.is_string(i)&&(i=s(i,e));n<i.length;n++)o.appendChild(a.option(i[n],i[n])),i[n]==e&&(o.selectedIndex=n);return o},d=function(e,t){var n=a.create(t.selector_tag,{"class":t.selector_class});return n.appendChild(i(e.getMonth(),t)),n.appendChild(l(e.getFullYear(),t)),n},u=function(e,t,n,a){this.date=new Date(e,t,n),this.day_of_week=this.date.getDay(),this.year=e,this.month=t,this.day=n,this.last_day=r.last_day(e,t),this.is_current=!!a};u.prototype.replace=function(e){return new u(this.year,this.month,e,this.is_current)},u.prototype.prev_month=function(){var e=this.month,t=this.year;return 0==e?(e=11,--t):--e,new u(t,e,this.last_day)},u.prototype.next_month=function(){var e=this.month,t=this.year;return 1==e?(e=0,++t):++e,new u(t,e,1)},u.prototype.toISOString=function(){return r.iso_string(this.date)},u.range=function(e){var t,n,a,s,o=e||new Date,c=new u(o.getFullYear(),o.getMonth(),o.getDate(),!0),i=new Date(c.year,c.month).getDay(),l=[];if(i)for(a=c.prev_month(),t=a.day-i+1,n=a.day;n>=t;t++)l.push(a.replace(t));for(t=1,n=r.last_day(c.year,c.month);n>=t;t++)l.push(c.replace(t));if(i=l.length%7)for(s=c.next_month(),t=1,n=7-i;n>=t;t++)l.push(s.replace(t));return l};var _=function(e,t){var n=a.create(t.day_tag,{"class":t.day_class});return e.is_current||(n.className+=" other"),t.day_onclick&&(r.is_string(t.day_onclick)?n.addEventListener("click",function(){document.getElementById(t.day_onclick).value=this.dataset.date},!1):n.addEventListener("click",t.day_onclick,!1)),n.appendChild(a.create(t.day_num_tag,{"class":t.day_num_class},e.day)),n.dataset.date=e.toISOString(),t.day_post_create&&t.day_post_create(n,e),n},p=function(e,t){for(var n,r,s=a.create(t.month_tag,{"class":t.month_class}),o=u.range(e),c=0;c<o.length;c++)n=o[c],c%7==0&&(r=a.create(t.week_tag,{"class":t.week_class}),s.appendChild(r)),r.appendChild(_(n,t));return s},y=function(e){document.addEventListener("keyup",function(n){n.keyCode===t&&a.display_element(e,!1)},!1)},h=function(e){document.addEventListener("click",function(t){var n=document.getElementById(e),r=n.getBoundingClientRect(),s=t.clientX,o=t.clientY,c=s>=r.left&&s<=r.right&&o>=r.top&&o<=r.bottom;console.log("contains",c),c||"none"===n.style.block||a.display_element(n,!1)},!1)},g=function(e,t,n){return function(){var r;n&&!1===n()||(a.display_element(e,!1),r=document.getElementById(t),r.value=this.dataset.date,r.focus())}},m=function(e,t){var a=t.date||new Date;t=r.merge(n,t||{}),e.setAttribute("data-date",r.iso_string(a)),e.appendChild(d(a,t)),e.appendChild(o(t)),e.appendChild(p(a,t))},f=function(e,t,n){var r=document.getElementById(e);document.getElementById(t).addEventListener("click",function(){a.display_element(e,!0),this.blur()},!1),y(e),h(e),n=n||{},n.day_onclick=g(e,t,n.day_onclick),m(r,n)};return{initialize:m,popout:f,Day:u,Utils:r,DOM:a}}();